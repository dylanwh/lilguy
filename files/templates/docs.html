{% extends "layout.html" %}

{% block title %}LilGuy Documentation{% endblock %}

{% block content %}
<article class="container">
    <header>
        <h1>LilGuy Documentation</h1>
        <p>Learn how to build web applications with LilGuy - a simple and powerful web framework combining Lua, HTMX,
            Pico CSS, and SQLite.</p>
    </header>

    <section id="getting-started">
        <h2>Getting Started</h2>
        <p>LilGuy applications are built using Lua as the primary programming language, with a powerful SQLite database
            backend, Jinja2 templates for views, HTMX for dynamic interactions, and Pico CSS for styling.</p>

        <h3>Creating a New Project</h3>
        <pre><code>lilguy new myapp
cd myapp</code></pre>

        <p>This creates a new project with the following structure:</p>
        <pre><code>.
├── app.lua        # Main application logic
├── assets/        # Static files (CSS, JS, images)
└── templates/     # Jinja2 templates</code></pre>
    </section>

    <section id="routing">
        <h2>Routing</h2>
        <p>Routes in LilGuy are defined in <code>app.lua</code> using the global <code>routes</code> table:</p>

        <pre><code>-- Basic route
routes["/"] = function(req, res)
    res:render("index.html", {
        message = "Welcome to LilGuy!"
    })
end

-- Route with parameters
routes["/users/:id"] = function(req, res)
    local id = req.params.id
    res:render("user.html", {
        user_id = id
    })
end

-- POST handler
routes["/submit"] = function(req, res)
    if req.method == "POST" then
        local data = req.form
        -- Process form data
        res:redirect("/thank-you")
    end
end</code></pre>
    </section>

    <section id="templates">
        <h2>Templates</h2>
        <p>LilGuy uses Jinja2-style templates for rendering HTML. Templates are stored in the <code>templates/</code>
            directory:</p>

        <pre><code>{% raw %}
<!-- templates/user.html -->
{% extends "layout.html" %}

{% block content %}
<article>
    <h1>User Profile</h1>
    {% if user %}
        <h2>{{ user.name }}</h2>
        <p>Email: {{ user.email }}</p>
    {% else %}
        <p>User not found</p>
    {% endif %}
</article>
{% endblock %}
{% endraw %}</code></pre>

        <p>Templates are rendered from route handlers using <code>res:render()</code>:</p>
        <pre><code>res:render("user.html", {
    user = {
        name = "Alice",
        email = "alice@example.com"
    }
})</code></pre>
    </section>

    <section id="database">
        <h2>Database</h2>
        <p>LilGuy provides easy access to SQLite through the global <code>database</code> object and persistent tables
            through <code>global</code>:</p>

        <h3>Using Raw SQL</h3>
        <pre><code>-- Execute a query
database:exec([[
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY,
        name TEXT NOT NULL,
        email TEXT UNIQUE NOT NULL
    )
]])

-- Insert data
database:exec("INSERT INTO users (name, email) VALUES (?, ?)",
    "Alice", "alice@example.com")</code></pre>

        <h3>Using Global Tables</h3>
        <pre><code>-- Create a persistent table
local users = global.users

-- Store data
users["alice"] = {
    name = "Alice",
    email = "alice@example.com"
}

-- Retrieve data
local user = users["alice"]
print(user.name) -- prints "Alice"

-- Iterate over all users
for key, user in users:pairs() do
    print(key, user.name)
end</code></pre>
    </section>

    <section id="htmx">
        <h2>HTMX Integration</h2>
        <p>LilGuy works seamlessly with HTMX for dynamic interactions. Here's an example of a simple dynamic form:</p>

        <pre><code>{% raw %}
<!-- templates/form.html -->
<form hx-post="/submit" hx-swap="outerHTML">
    <input type="text" name="name" required>
    <button type="submit">Submit</button>
</form>

<!-- Route handler -->
routes["/submit"] = function(req, res)
    if req.method == "POST" then
        local name = req.form.name
        res.headers["HX-Trigger"] = "userAdded"
        res:render("success.html", {
            message = "Thanks, " .. name .. "!"
        })
    end
end{% endraw %}</code></pre>
    </section>

    <section id="assets">
        <h2>Static Assets</h2>
        <p>Place your static files (CSS, JavaScript, images) in the <code>assets/</code> directory. They will be
            automatically served at <code>/assets/</code>:</p>

        <pre><code>assets/
├── styles.css
├── app.js
└── images/
    └── logo.png</code></pre>

        <p>Reference them in your templates:</p>
        <pre><code>{% raw %}<link rel="stylesheet" href="/assets/styles.css">
<script src="/assets/app.js"></script>
<img src="/assets/images/logo.png">{% endraw %}</code></pre>
    </section>

    <section id="advanced">
        <h2>Advanced Features</h2>

        <h3>Middleware</h3>
        <pre><code>function auth_middleware(next)
    return function(req, res)
        if not req.session.user then
            res:redirect("/login")
            return
        end
        next(req, res)
    end
end

routes["/dashboard"] = auth_middleware(function(req, res)
    res:render("dashboard.html")
end)</code></pre>

        <h3>WebSocket Support</h3>
        <pre><code>on_websocket = function(ws)
    ws:on("message", function(msg)
        print("Received:", msg)
        ws:send("Echo: " .. msg)
    end)
end</code></pre>

        <h3>Background Tasks</h3>
        <pre><code>on_startup = function()
    -- Run background tasks when the server starts
    async(function()
        while true do
            -- Do something periodically
            sleep(60)
        end
    end)
end</code></pre>
    </section>

    <section id="deployment">
        <h2>Deployment</h2>
        <p>LilGuy applications can be deployed as a single binary. Build your application:</p>
        <pre><code>lilguy build</code></pre>

        <p>Run in production:</p>
        <pre><code>./myapp serve --port 8080</code></pre>
    </section>
</article>

<style>
    pre {
        background-color: #f5f5f5;
        padding: 1rem;
        border-radius: 4px;
        overflow-x: auto;
    }

    code {
        font-family: 'Fira Code', monospace;
    }

    section {
        margin-bottom: 2rem;
    }

    h2 {
        margin-top: 2rem;
    }

    h3 {
        margin-top: 1.5rem;
    }
</style>
{% endblock %}